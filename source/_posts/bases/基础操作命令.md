---
title: kubernetes基础操作命令
date: 2022-02-11 12:19:35
author: James
img: https://buleye.oss-cn-shenzhen.aliyuncs.com/images/202202111107079.png
cover: true
coverImg: https://buleye.oss-cn-shenzhen.aliyuncs.com/images/202201121153157.png
toc: true
summary:  
categories: kubernetes
tags:
  - kubernetes
---

## 操作命令

### 集群信息

```
kubectl cluster-info
```

### `namespace`

- 查看`<namespace>`

```
kubectl get ns
```

### 节点信息

- 查看节点

```
kubectl get nodes
```

- 查看节点信息

```
kubectl get node -o wide 
```

- 查看节点CPU和内存占用

```
kubectl top node 
```

- 查看节点详细信息

```
kubectl describe node <NODENAME>
```

### `POD`

- 查看指定`namespace`下的`pod`

```
kubectl get pod -n <NAMESPACE>
```

- 通过`label`查看pod

```
kubectl get pod -n rook-ceph -l app=rook-ceph-osd
```

### 查看日志

- 直接查看日志

```
kubectl log -f -n <NAMESPACE> <PODNAME>
```

- 查看重启前日志

```
kubectl log -f -n <NAMESPACE> <PODNAME> -p 
```

- 查看指定容器日志

```
kubectl log -f -n <NAMESPACE> <PODNAME> -c <CONTAINER NAME>
```

### 编辑

- 直接编辑yaml

```
kubectl edit <对像类型> <对像名称>
```

### 删除

- 普通删除

```
kubectl delete <对像类型> <对像名称>
```
- 强制删除

```
kubectl delete <对像类型> <对像名称> --force --
```

### SVC

- 查看`svc`

```
kubectl get svc
```

- 暴露对外访问

```
kubectl expose <DEPLOYMENT/STATEFULSET> <NAME> --name=<SVCNAME> --port=<LOCAL PORT> --target-port=<REMOTE PORT>
```

### `YAML`

- 根据`yaml`创建

```
kubectl create -f /path/yaml/file
```

- 根据`yaml`更新

```
kubectl apply -f /path/yaml/file
```

- 根据`yaml`删除

```
kubectl delete -f /path/yaml/file
```

## 常用排查思路![问题排查](/Users/james/Documents/www.buleye.com/source/_posts/bases/images/%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4/%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5.png)

## 节点操作

### 新增节点

```
make addnode
```

### 新增存储节点

```
make addnode
```

### **下线节点**

```
kubectl cordon <node-name>
kubectl drain <node-name> --ignore-daemonsets
kubectl delete node <node-name>
对该节点进行 reset
手动修改主机hosts移除对应机器解析记录
```

### 下线存储节点

- 先执行该主机osd移除

[移除osd](/Users/james/Documents/rook移除osd.md)

- 再进行下线节点操作

## 存储操作

### 新增OSD

- 修改cncp.yaml，更改node以及csi配置，新增存储节点

```
```

- 执行make cncp

```
单独执行020部分
```

### 移除OSD

[移除osd](/Users/james/Documents/rook移除osd.md)

## 网络

### 扩容网络

- 检查IP是否满足扩容条件
  - 和已经存在的IP同一个vlan
  - 可对提供服务的客户直连

- 修改cncp.yaml配置cni部分

```
make gen
cd clusterinfo
kubectl apply -f cni_v1_pool.yaml -f  cni_v1_subnet.yaml -f multus-netMacvlan.yaml
```

### 修改组件IP

[修改组件IP](/Users/james/Documents/%E4%BF%AE%E6%94%B9%E7%BB%84%E4%BB%B6IP.pdf)







 云原生组件平台基于Kubernetes研发，以容器化方式为南网云提供Redis、RabbitMQ、MongoDB、ActiveMQ、Kafka等通用服务组件能力。	
       通过可视化操作界面带来良好的用户交互体验，提升运维效率，并同时可进行组件资源管控、项目管理、审批流程及审批记录管理、组件备份与数据查看、集群管理以及系统设置、人员权限管理等核心功能。

